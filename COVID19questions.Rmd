---
title: "COVID-19 questions"
output:
  learnr::tutorial:
    version: 0.2
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
description: >
  Exploit COVID-19 for graph interpretation
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
```

## <!-- makes a new page, without a header or index entry -->

```{r, echo=FALSE, messages=FALSE}
NSW<- readRDS(file="NSWcases.Rda")
```

The following plot shows the number of confirmed cases of COVID-19 infection on each day in the state of New South Wales in Australia since 4 March.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height=4, fig.width=4,  fig.cap = ""}
require(ggplot2)
NSWcor<-cor.test(as.numeric(NSW$date),NSW$cases) 
g<-ggplot( data = NSW, aes( date, cases )) + geom_point() + theme_bw() + ylab("Confirmed cases in NSW") + scale_x_date(date_minor_breaks=("1 days")) + ylim(0,NA)
show(g)
```


```{r axes}
question("Which is true of the axes of this plot?",
    answer("The horizontal axis is geometric; the vertical is logarithmic."),
    answer("The horizontal axis is linear; the vertical is logarithmic.", correct=TRUE, message="Correct. The vertical axis is logarithmic."),
    answer("The horizontal axis is logarithmic; the vertical is hypergeometric."),
    answer("The horizontal axis is logarithmic; the vertical is logarithmic."),
    allow_retry = TRUE
)
```


```{r slope1}
question("What would a perfectly straight line on this plot indicate? Select ALL that are correct.",
    answer("A constant rate of increase.", correct=TRUE),
    answer("The doubling time of the number of confirmed cases is constant.", message="No, that would be an exponential growth rather than linear."),
    answer("Each day, the number of confirmed cases increases by a constant percentage.", message="No, that would be an exponential growth rather than linear."),
    answer("Each day, the number of confirmed cases increases by the same amount as the previous day.", correct=TRUE),
    allow_retry = TRUE
)
```


```{r slope2}
question("Between 9 March and 23 March, what was the pattern for the increase in cases?  Select ALL that are correct:",
    answer("The cases increased steadily, at a constant rate.", message="No, that would only be true if the cases fell on a straight line."),
    answer("More quickly at the end of that period than at the beginning.", correct=TRUE),
    answer("Each day, the number of cases decreased by a constant percentage.", message="No, they certainly did not decrease."),
    answer("They accelerated.", correct=TRUE),
    allow_retry = TRUE
)
```

## <!--Exponential comparison-->

Below, light blue dots have been added to the plot.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height=4, fig.width=4,  fig.cap = "" }
require(ggplot2)
start<-22; pctIncrease<-20
NSW$exponential<-22
for(i in 2:length(NSW$date)) {
  NSW$exponential[i] <- NSW$exponential[i-1]*(1+pctIncrease/100)
}
h<-ggplot( data = NSW, aes( date, cases )) + geom_point() + theme_bw() + ylab("Confirmed cases in NSW") + scale_x_date(date_minor_breaks=("1 days")) + ylim(0,NA) + 
  geom_point(data = NSW, aes(x = date, y = exponential), color = "blue", alpha=.6)
show(h)
```

If the number of cases had increased by 20% each day, then the black dots (the real data) would fall exactly on top of the blue dots. In other words, the blue dots show the number of cases that would have occurred if there had been a 20% increase in cases each day. The raw numerical (not percentage) change in cases is greater for each day. This is because 20% of a larger number is greater than that of a smaller number. As a result, the graph becomes steeper and steeper as the number of cases grows.

```{r relativeToExponential}
question("What does the 20% comparison (the blue dots) indicate about the real data?",
    answer("The real cases increased steadily, at a constant rate."),
    answer("The real cases increased much more slowly than 20%/day at first, but then increased at a faster rate.", correct=TRUE),
    answer("The real cases increased at a faster than 20%/day rate"),
    answer("The real cases increased at close to 20% per day at first, but later increased more slowly.", correct=TRUE),
    allow_retry = TRUE
)
```

When the number of cases does grow by the same percentage each day, it is called "exponential growth". It is what would occur if a person who is infected infects more than one other person on average. For 20% daily growth, on average each person would have to infect 1.2 others.

## Exponential growth

"Exponential growth" refers to when something increases by the same percentage on each day. Below, the data have been replotted with the vertical axis percent increase compared to the previous day rather than total number of cases. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height=4, fig.width=4,  fig.cap = ""}
#Calculate proportional increase
increase<-diff(NSW$cases)
increase<-c(0,increase) #pad with 0 for first item
NSW$increase <- increase

NSW$increaseE <- pctIncrease #Because manual gets it slightly wrong probably because wrong starting date or something

#increaseE<-diff(NSW$exponential)
#increaseE<-c(0,increaseE) #pad with 0 for first item
#NSW$increaseE <- increaseE
excludeFirst <- tail(NSW,-1)

j<-ggplot( data = excludeFirst, aes( date, 100*increase/cases )) + geom_point() + theme_bw() + ylab("% increase in NSW confirmed cases") + scale_x_date(date_minor_breaks=("1 days")) + ylim(0,40) +
    geom_point(data = excludeFirst, aes(x = date, y = increaseE), color = "blue", alpha=.6)
show(j)
```

The blue dots now form a horizontal line, because they were created by calculating a 20% increase compared to the previous day.
The reason that virus infections can grow exponentially is that each new person infected contributes an additional number of cases to the next day, by passing the virus on to more than one person (on average). Thus the new number of cases is some multiple (percentage added to) of the previous day's cases.

For the real data (the black dots), this graph makes it obvious that after 23 March especially, there was not a constant percentage increase each day. Instead, the percentage increase became less and less.


##
The below plot shows, for each day, the percentage increase in confirmed cases from the previous day.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height=4, fig.width=4,  fig.cap = "" }

NSWcori<-cor.test(as.numeric(NSW$date),NSW$increase/NSW$cases) 
h<-ggplot( data = excludeFirst, aes( date, 100*increase/cases )) + geom_point() + theme_bw() + ylab("Percent increase in NSW confirmed cases") + scale_x_date(date_minor_breaks=("1 days")) +
  annotate("text",x=as.Date("2020/3/16"),y=13, label=paste0("r=",round(NSWcori$estimate,2)), parse=FALSE)
show(h)
```

```{r pctage}
question("If the number of cases grew exactly exponentially, where would the datapoints be?",
    answer("On an accelerating curve.", message="That would be true if the vertical axis was number of cases, but not true with this percentage increase vertical axis."),
    answer("On a straight line with an upward slope."),
    answer("On a straight line with a downward slope."),
    answer("A flat horizontal line.", correct=TRUE),
    allow_retry = TRUE
)
```

## Semi-log plot 

While the % increase vertical axis is useful, it unfortunately does not show the cumulative number of cases, only the change since the previous day. As a result, from that graph we don't see how high the caseload has gotten. This is one reason that people often use a logarithmic vertical axis in situations of constant (or even approximate) percentage growth.

On a non-logarithmic (linear) axis, a constant increase in *number* (not percentage) of cases results in a straight line. The greater the daily increase, the steeper the slope of the line. In other words, constant addition corresponds to a constant slope on a graph.

For the case of exponential growth, we are interested in knowing what the number of cases is being *multiplied by* each day, not how much is being added to it. In the case of 20% growth, for instance, on each day the number of cases is the previous number plus 20%, which can be calculated by multiplying the previous day's number of cases by 1.2.

Logarithms turn multiplication into addition, which means that on a logarithmic axis, stepping upward by a constant amount does not mean the number of cases has increased by the same number each time, but rather that it's been multiplied by the same number each time.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height=4, fig.width=4,  fig.cap = "" }

k<-ggplot( data = NSW, aes( date, exponential )) + geom_point(color="blue",alpha=.6) + theme_bw() + ylab("Confirmed cases in NSW") + scale_x_date(date_minor_breaks=("1 days")) + ylim(0,NA) +  theme(panel.grid.minor.y = element_blank())
show(k + scale_y_log10() )

```

In the above plot, notice that the vertical axis labels do not mark out equal intervals additively. Rather, stepping up with steps of a particular size corresponds to multiplying by a constant amount with each step. Eac successive y-axis label is the previous label multipled by approximately three.

an increment does not mean a constant is added to the number of cases each day, but rather a
the number of cases increases by the s

And multiplying by a constant on each day (e.g., 1.2 for 20% increase) is what exponential growth is. Thus, while 

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height=4, fig.width=4,  fig.cap = "" }

k<-ggplot( data = NSW, aes( date, cases )) + geom_point() + theme_bw() + ylab("Confirmed cases in NSW") + scale_x_date(date_minor_breaks=("1 days")) + ylim(0,NA) + 
  geom_point(data = NSW, aes(x = date, y = exponential), color = "blue", alpha=.6) +  theme(panel.grid.minor.y = element_blank()) +
  scale_y_log10() 
show(k) 

```

Compound interest

A constant 
The percentage change plot is 

Constant slope means 

## A popular and complicated plot

```{r, echo=FALSE, out.width = "750px"}
knitr::include_graphics("images/30MarCovid19CasesFT.png") #You can't change the image directory for Shiny apps
``` 

What may be slightly confusing in this plot is that the labels on the vertical axis are not equally spaced, in order to position them at round numbers.

```{r, echo=FALSE, fig.cap="https://twitter.com/jperla/status/1243349875015553024", out.width = "750px"}
knitr::include_graphics("images/masksNoMasksExplainsIt.png") #You can't change the image directory for Shiny apps
``` 




```{r ideaimage}
question("What idea do you think the person who scrawled on this image wished to encourage?",
    answer("Masks prevent COVID-19 cases from growing exponentially.",message="No, because the lines in the Masks group are fairly linear on this semi-log plot, indicating that they are growing exponentially, just slower than the masks ones"),
    answer("COVID-19 cases encourage mask wearing."),
    answer("Wearing a mask slows the rate of infections.", correct = TRUE),
    answer("Masks are an important dependent variable"),
    allow_retry = TRUE
)
```

## Next

```{r, echo=FALSE, fig.cap="https://twitter.com/jperla/status/1243349875015553024", out.width = "750px"}
knitr::include_graphics("images/masksNoMasksExplainsIt.png") #You can't change the image directory
``` 

```{r ideaimage2}
question("'Wearing a mask slows the rate of infection' is an example of:",
    answer("An inescapable conclusion.",message="jump"),
    answer("A correlational statement."),
    answer("A causal statement.", correct = TRUE),
    answer("A very ambiguous statement.", message="I don't see anything particularly ambiguous about this."),
    answer("An independently variable statement.", message= "This sentence doesn't mean anything, as far as I know."),
    allow_retry = TRUE
)
```

A common mistake people make is to assume there is only one reason for 

```{r ianotherFactor}
question("Other factor(s) that might explain some of the difference between the blue-circled countries and the red ones:",
    answer("Climate.",correct=TRUE),
    answer("Handshaking customs.",correct=TRUE),
    answer("Government diligence in testing and tracing contacts of COVID-19 patients.", correct=TRUE),
    answer("Responsiveness of population to government recommendations.", correct=TRUE),
    answer("Quarantine policy.", correct=TRUE),
    allow_retry = TRUE
)
```

## Reactions

```{r, echo=FALSE, out.width = "400px"}
knitr::include_graphics("images/maskNoMasksReactions.png")
``` 


```{r multivariate}
question("What standard approach might be used to try to estimate the effects of mask wearing and temperature?",
    answer("Multivariate regression.",correct=TRUE),
    answer("Standard deviation."),
    answer("Regression to the mean."),
    answer("Post hoc ergo propter hoc.", message="I don't see anything particularly ambiguous about this."),
    allow_retry = TRUE
)
```


But, with an exponentially-growing pandemic, we don't have time to wait for strong evidence.
